<!-- STOP
This file was generated by a rundoc script, don't modify it.
Instead modify the rundoc script and re-run it.
STOP -->

<p>Ruby on Rails is a popular web framework written in <a href="http://www.ruby-lang.org/">Ruby</a>. This guide covers using Rails 4 on Heroku, running previous versions of Rails on Heroku see <a href="https://devcenter.heroku.com/articles/getting-started-with-rails3">Getting Started with Rails 3.x on Heroku</a>.</p>

<div class="callout">
<p>If you are already familiar with Heroku and Rails, reference the <a href="https://devcenter.heroku.com/articles/rails4">simplified Rails 4 on Heroku guide</a> instead. For general information on how to develop and architect apps for use on Heroku, see <a href="https://devcenter.heroku.com/articles/architecting-apps">Architecting Applications for Heroku</a>.</p>
</div>

<p>For this guide you will need:</p>

<ul>
<li>Basic Ruby/Rails knowledge</li>
<li>Locally installed version of Ruby, Rubygems, Bundler, and Rails 4+</li>
<li>Basic Git knowledge</li>
<li>A Heroku user account: <a href="https://api.heroku.com/signup/devcenter">Signup is free and instant</a>
</li>
</ul><div class="note">
<p>If you have questions about Ruby on Heroku, consider discussing it in the <a href="https://discussion.heroku.com/category/ruby">Ruby on Heroku forums</a>.</p>
</div>

<h2 id="local-workstation-setup">Local Workstation Setup</h2>

<p>First, install the Heroku Toolbelt on your local workstation.</p>

<p><a class="toolbelt" href="https://toolbelt.heroku.com/">Install the Heroku Toolbelt</a></p>

<p>This ensures that you have access to the <a href="https://devcenter.heroku.com/categories/command-line">Heroku command-line client</a>, Foreman, and the Git revision control system.  You will also need <a href="http://guides.railsgirls.com/install/">Ruby and Rails installed</a>.</p>

<p>Once installed, you’ll have access to the <code>heroku</code> command from your command shell. Log in using the email address and password you used when creating your Heroku account:</p>

<div class="callout">
<p>Note that <code>$</code> symbol before commands indicates they should be run on the command line, prompt, or terminal with appropriate permissions. Do not copy the <code>$</code> symbol.</p>
</div>

<pre><code class="term">$ heroku login
Enter your Heroku credentials.
Email: schneems@example.com
Password:
Could not find an existing public key.
Would you like to generate one? [Yn]
Generating new SSH public key.
Uploading ssh public key /Users/adam/.ssh/id_rsa.pub
</code></pre>

<p>Press enter at the prompt to upload your existing <code>ssh</code> key or create a new one, used for pushing code later on.</p>

<h2 id="write-your-app">Write your App</h2>

<div class="callout">
<p>To run on Heroku your app must be configured to use the Postgres database, have all dependencies declared in your <code>Gemfile</code>, and have the <code>rails_12factor</code> gem in the production group of your <code>Gemfile</code></p>
</div>

<p>You may be starting from an existing app, if so <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#upgrading-from-rails-3-2-to-rails-4-0">upgrade to Rails 4</a> before continuing. If not, a vanilla Rails 4 app will serve as a suitable sample app. To build a new app make sure that you’re using the Rails 4.x using <code>$ rails -v</code>. You can get the new version of rails by running,</p>

<pre><code class="term">$ gem install rails --no-ri --no-rdoc
Successfully installed rails-4.1.0
1 gem installed
</code></pre>

<p>Then create a new app:</p>

<pre><code class="term">$ rails new myapp --database=postgresql
</code></pre>

<p>Once finished change your directory to the newly created Rails app</p>

<pre><code class="term">$ cd myapp
</code></pre>

<div class="callout">
<p>If you experience problems or get stuck with this tutorial, your questions may be answered in a later part of this document. Once you experience a problem try reading through the entire document and then going back to your issue. It can also be useful to review your previous steps to ensure they all executed correctly.</p>
</div>

<p>Note: If your <code>rails</code> commands hang for any reason it may be a result of running <code>spring</code>. You can stop spring by running</p>

<pre><code class="term">$ spring stop
Spring stopped.
</code></pre>

<p>Rails 4 no longer has a static index page in production. When you’re using a new app, there will not be a root page in production, so we need to create one. We will first create a controller called <code>welcome</code> for our home page to live:</p>

<pre><code class="term">$ rails generate controller welcome
</code></pre>

<p>Next we’ll add an index page.</p>

<p>In file <code>app/views/welcome/index.html.erb</code> write:</p>

<pre><code class="html">&lt;h2&gt;Hello World&lt;/h2&gt;
&lt;p&gt;
  The time is now: &lt;%= Time.now %&gt;
&lt;/p&gt;
</code></pre>

<p>Now we need to have Rails route to this action. We’ll edit <code>config/routes.rb</code> to set the index page to our new method:</p>

<p>In file <code>config/routes.rb</code>, on line 2 add:</p>

<pre><code class="ruby">  root 'welcome#index'
</code></pre>

<p>You can verify that the page is there by running your server:</p>

<pre><code class="term">$ rails server
</code></pre>

<p>And visiting <a href="http://localhost:3000">http://localhost:3000</a> in your browser. If you do not see the page, use the logs that are output to your server to debug.</p>

<h2 id="heroku-gems">Heroku gems</h2>

<p>Heroku integration has previously relied on using the Rails plugin system, which has been removed from Rails 4. To enable features such as static asset serving and logging on Heroku please add <code>rails_12factor</code> gem to your <code>Gemfile</code>.</p>

<p>At the end of <code>Gemfile</code> add:</p>

<pre><code class="ruby">gem 'rails_12factor', group: :production
</code></pre>

<p>Then run:</p>

<pre><code class="term">$ bundle install
</code></pre>

<p>We talk more about Rails integration on our <a href="https://devcenter.heroku.com/articles/ruby-support#injected-plugins">Ruby Support page</a>.</p>

<h2 id="use-postgres">Use Postgres</h2>

<div class="callout">
<p>We highly recommend using PostgreSQL during development. Maintaining <a href="http://www.12factor.net/dev-prod-parity">parity between your development</a> and deployment environments prevents subtle bugs from being introduced because of differences between your environments. <a href="https://devcenter.heroku.com/articles/heroku-postgresql#local-setup">Install Postgres locally</a> now if it is not already on your system.</p>
</div>

<p>If you did not specify <code>postgresql</code> while creating your app (using <code>--database=postgresql</code>) you will need to add the <code>pg</code> gem to your Rails project. Edit your <code>Gemfile</code> and change this line:</p>

<pre><code class="ruby">gem 'sqlite3'
</code></pre>

<p>To this:</p>

<pre><code class="ruby">gem 'pg'
</code></pre>

<p>You can get more information on why this change is needed and how to configure your app to run postgres locally see <a href="https://devcenter.heroku.com/articles/sqlite3">why you cannot use Sqlite3 on Heroku</a>.</p>

<p>In addition to using the <code>pg</code> gem, you’ll also need to ensure the <code>config/database.yml</code> is using the <code>postgresql</code> adapter.</p>

<p>You will also need to remove the <code>username</code> field in your <code>database.yml</code> if there is one so:</p>

<p>In file <code>config/database.yml</code> remove:</p>

<pre><code>username: myapp
</code></pre>

<p>This line tells rails that the database <code>myapp_development</code> should be run under a role of <code>myapp</code>. Since you likely don’t have this role in your database we will remove it. With the line removed, Rails will try to access the database as a user who is currently logged into the computer.</p>

<p>The development section of your <code>config/database.yml</code> file should look something like this:</p>

<pre><code class="term">$ cat config/database.yml
# PostgreSQL. Versions 8.2 and up are supported.
#
# Install the pg driver:
#   gem install pg
# On OS X with Homebrew:
#   gem install pg -- --with-pg-config=/usr/local/bin/pg_config
# On OS X with MacPorts:
#   gem install pg -- --with-pg-config=/opt/local/lib/postgresql84/bin/pg_config
# On Windows:
#   gem install pg
#       Choose the win32 build.
#       Install PostgreSQL and put its /bin directory on your path.
#
# Configure Using Gemfile
# gem 'pg'
#
default: &amp;default
  adapter: postgresql
  encoding: unicode
  # For details on connection pooling, see rails configuration guide
  # http://guides.rubyonrails.org/configuring.html#database-pooling
  pool: 5
</code></pre>

<p>Be careful here, if you omit the <code>sql</code> at the end of <code>postgresql</code> your application will not work.</p>

<p>Now re-install your dependencies (to generate a new <code>Gemfile.lock</code>):</p>

<pre><code class="ruby">$ bundle install
</code></pre>

<h2 id="specify-ruby-version-in-app">Specify Ruby version in app</h2>

<p>Rails 4 requires Ruby 1.9.3 or above. Heroku has a recent version of Ruby installed, however you can specify an exact version by using the <code>ruby</code> DSL in your <code>Gemfile</code>. For this guide we’ll be using Ruby 2.1.1 so add this to your <code>Gemfile</code>:</p>

<p>At the end of <code>Gemfile</code> add:</p>

<pre><code class="ruby">ruby "2.1.1"
</code></pre>

<p>You should also be running the same version of Ruby locally. You can verify by running <code>$ ruby -v</code>. You can get more information on <a href="https://devcenter.heroku.com/articles/ruby-versions">specifying your Ruby version on Heroku here</a>.</p>

<h2 id="store-your-app-in-git">Store your App in Git</h2>

<p>Heroku relies on <a href="http://git-scm.com/">git</a>, a distributed source control managment tool, for deploying your project. If your project is not already in git first verify that <code>git</code> is on your system:</p>

<pre><code class="term">$ git --help
usage: git [--version] [--help] [-c name=value]
           [--exec-path[=&lt;path&gt;]] [--html-path] [--man-path] [--info-path]
           [-p|--paginate|--no-pager] [--no-replace-objects] [--bare]
           [--git-dir=&lt;path&gt;] [--work-tree=&lt;path&gt;] [--namespace=&lt;name&gt;]
           &lt;command&gt; [&lt;args&gt;]

The most commonly used git commands are:
   add        Add file contents to the index
   bisect     Find by binary search the change that introduced a bug
   branch     List, create, or delete branches
</code></pre>

<p>If you don’t see any output or get <code>command not found</code> you will need to install it on your system, verify that the <a href="https://toolbelt.heroku.com/">Heroku toolbelt</a> is installed.</p>

<p>Once you’ve verified that git works, first make sure you are in your Rails app directory by running:</p>

<pre><code class="term">$ ls
</code></pre>

<p>The output should look like this:</p>

<pre><code class="term">$ ls
Gemfile
Gemfile.lock
README.rdoc
Rakefile
app
bin
config
config.ru
db
lib
log
public
test
tmp
vendor
</code></pre>

<p>Now run these commands in your Rails app directory to initialize and commit your code to git:</p>

<pre><code class="term">$ git init
$ git add .
$ git commit -m "init"
</code></pre>

<p>You can verify everything was committed correctly by running:</p>

<pre><code class="term">$ git status
# On branch master
nothing to commit, working directory clean
</code></pre>

<p>Now that your application is committed to git you can deploy to Heroku.</p>

<h2 id="deploy-your-application-to-heroku">Deploy your application to Heroku</h2>

<p>Make sure you are in the directory that contains your Rails app, then create an app on Heroku:</p>

<pre><code class="term">$ heroku create
Creating warm-wave-1943... done, stack is cedar
http://warm-wave-1943.herokuapp.com/ | git@heroku.com:warm-wave-1943.git
Git remote heroku added
</code></pre>

<p>You can verify that the remote was added to your project by running</p>

<pre><code class="term">$ git config -e
</code></pre>

<p>If you see <code>fatal: not in a git directory</code> then you are likely not in the correct directory. Otherwise you may deploy your code. After you deploy your code, you will need to migrate your database, make sure it is properly scaled and use logs to debug any issues that come up.</p>

<p>Deploy your code:</p>

<pre><code class="term">$ git push heroku master
Initializing repository, done.

-----&gt; Ruby app detected
-----&gt; Compiling Ruby/Rails
-----&gt; Using Ruby version: ruby-2.1.1
-----&gt; Installing dependencies using 1.5.2
       Running: bundle install --without development:test --path vendor/bundle --binstubs vendor/bundle/bin -j4 --deployment
       Fetching gem metadata from https://rubygems.org/..........
       Fetching additional metadata from https://rubygems.org/..
       Using json (1.8.1)
       Installing i18n (0.6.9)
       Installing rake (10.3.0)
       Installing builder (3.2.2)
       Installing minitest (5.3.3)
       Installing thread_safe (0.3.3)
       Installing mime-types (1.25.1)
       Installing erubis (2.7.0)
       Installing polyglot (0.3.4)
       Installing arel (5.0.1.20140414130214)
       Installing execjs (2.0.2)
       Installing coffee-script-source (1.7.0)
       Installing rack (1.5.2)
       Installing hike (1.2.3)
       Using bundler (1.5.2)
       Installing thor (0.19.1)
       Installing multi_json (1.9.2)
       Installing tilt (1.4.1)
       Installing rails_serve_static_assets (0.0.2)
       Installing rails_stdout_logging (0.0.3)
       Installing sass (3.2.19)
       Installing rdoc (4.1.1)
       Installing tzinfo (1.1.0)
       Installing uglifier (2.5.0)
       Installing treetop (1.4.15)
       Installing coffee-script (2.2.0)
       Installing rack-test (0.6.2)
       Installing rails_12factor (0.0.2)
       Installing sprockets (2.11.0)
       Installing sdoc (0.4.0)
       Installing activesupport (4.1.0)
       Installing mail (2.5.4)
       Installing activemodel (4.1.0)
       Installing jbuilder (2.0.6)
       Installing actionview (4.1.0)
       Installing activerecord (4.1.0)
       Installing actionpack (4.1.0)
       Installing sprockets-rails (2.1.3)
       Installing actionmailer (4.1.0)
       Installing railties (4.1.0)
       Installing coffee-rails (4.0.1)
       Installing jquery-rails (3.1.0)
       Installing turbolinks (2.2.2)
       Installing sass-rails (4.0.3)
       Installing rails (4.1.0)
       Installing pg (0.17.1)
       Your bundle is complete!
       Gems in the groups development and test were not installed.
       It was installed into ./vendor/bundle
       Post-install message from rdoc:
       Depending on your version of ruby, you may need to install ruby rdoc/ri data:
       &lt;= 1.8.6 : unsupported
       = 1.8.7 : gem install rdoc-data; rdoc-data --install
       = 1.9.1 : gem install rdoc-data; rdoc-data --install
       &gt;= 1.9.2 : nothing to do! Yay!
       Bundle completed (48.17s)
       Cleaning up the bundler cache.
-----&gt; Preparing app for Rails asset pipeline
       Running: rake assets:precompile
       I, [2014-04-17T17:54:07.273555 #1263]  INFO -- : Writing /tmp/build_8945fb34-0238-41d7-a2fd-4402581a95fe/public/assets/application-10faafa06109fa14582542ac1852f5c5.js
       I, [2014-04-17T17:54:07.338617 #1263]  INFO -- : Writing /tmp/build_8945fb34-0238-41d7-a2fd-4402581a95fe/public/assets/application-9cc0575249625b8d8648563841072913.css
       Asset precompilation completed (11.26s)
       Cleaning assets
       Running: rake assets:clean
-----&gt; WARNINGS:
       No Procfile detected, using the default web server (webrick)
       https://devcenter.heroku.com/articles/ruby-default-web-server
-----&gt; Discovering process types
       Procfile declares types -&gt; (none)
       Default types for Ruby  -&gt; console, rake, web, worker

-----&gt; Compressing... done, 21.9MB
-----&gt; Launching... done, v6
       http://warm-wave-1943.herokuapp.com/ deployed to Heroku

To git@heroku.com:warm-wave-1943.git
 * [new branch]      master -&gt; master
</code></pre>

<p>It is always a good idea to check to see if there are any warnings or errors in the output. If everything went well you can migrate your database.</p>

<h2 id="migrate-your-database">Migrate your database</h2>

<p>If you are using the database in your application you need to manually migrate the database by running:</p>

<pre><code class="term">$ heroku run rake db:migrate
</code></pre>

<p>Any commands after the <code>heroku run</code> will be executed on a Heroku <a href="https://devcenter.heroku.com/articles/dynos">dyno</a>.</p>

<h2 id="visit-your-application">Visit your application</h2>

<p>You’ve deployed your code to Heroku. You can now instruct Heroku to execute a process type. Heroku does this by running the associated command in a <a href="https://devcenter.heroku.com/articles/dynos">dyno</a> - a lightweight container which is the basic unit of composition on Heroku.</p>

<p>Let’s ensure we have one dyno running the <code>web</code> process type:</p>

<pre><code class="term">$ heroku ps:scale web=1
</code></pre>

<p>You can check the state of the app’s dynos. The <code>heroku ps</code> command lists the running dynos of your application:</p>

<pre><code class="term">$ heroku ps
=== web (1X): `bin/rails server -p $PORT -e $RAILS_ENV`
web.1: starting 2014/04/17 12:54:20 (~ 3s ago)
</code></pre>

<p>Here, one dyno is running.</p>

<p>We can now visit the app in our browser with <code>heroku open</code>.</p>

<pre><code class="term">$ heroku open
Opening warm-wave-1943... done
</code></pre>

<p>You should now see the “Hello World” text we inserted above.</p>

<p>Heroku gives you a default web url for simplicty while you are developing. When you are ready to scale up and use Heroku for production you can add your own <a href="https://devcenter.heroku.com/articles/custom-domains">Custom Domain</a>.</p>

<h2 id="view-the-logs">View the logs</h2>

<p>If you run into any problems getting your app to perform properly, you will need to check the logs.</p>

<p>You can view information about your running app using one of the <a href="https://devcenter.heroku.com/articles/logging">logging commands</a>, <code>heroku logs</code>:</p>

<pre><code class="term">$ heroku logs
2014-04-17T17:52:41.286751+00:00 heroku[api]: Enable Logplex by developer@example.com
2014-04-17T17:52:41.286873+00:00 heroku[api]: Release v2 created by developer@example.com
2014-04-17T17:52:54+00:00 heroku[slug-compiler]: Slug compilation started
2014-04-17T17:54:19.695689+00:00 heroku[api]: Release v3 created by developer@example.com
2014-04-17T17:54:20.047893+00:00 heroku[api]: Deploy 4a37583 by developer@example.com
2014-04-17T17:54:19.695584+00:00 heroku[api]: Set DATABASE_URL config vars by developer@example.com
2014-04-17T17:54:19.214087+00:00 heroku[api]: Scale to web=1 by developer@example.com
2014-04-17T17:54:19.797989+00:00 heroku[api]: Attach HEROKU_POSTGRESQL_JADE resource by developer@example.com
2014-04-17T17:54:19.798073+00:00 heroku[api]: Release v4 created by developer@example.com
2014-04-17T17:54:19.946728+00:00 heroku[api]: Set LANG, RAILS_ENV, RACK_ENV, SECRET_KEY_BASE config vars by developer@example.com
2014-04-17T17:54:19.946728+00:00 heroku[api]: Release v5 created by developer@example.com
2014-04-17T17:54:20+00:00 heroku[slug-compiler]: Slug compilation finished
2014-04-17T17:54:22.006939+00:00 heroku[api]: Scale to web=1 by developer@example.com
2014-04-17T17:54:20.048071+00:00 heroku[api]: Release v6 created by developer@example.com
2014-04-17T17:54:24.109164+00:00 heroku[web.1]: Starting process with command `bin/rails server -p 18367 -e production`
</code></pre>

<p>You can also get the full stream of logs by running the logs command with the <code>--tail</code> flag option like this:</p>

<pre><code class="term">$ heroku logs --tail
</code></pre>

<h2 id="dyno-sleeping-and-scaling">Dyno sleeping and scaling</h2>

<p>Having only a single web dyno running will result in the dyno <a href="https://devcenter.heroku.com/articles/dynos#dyno-sleeping">going to sleep</a> after one hour of inactivity.  This causes a delay of a few seconds for the first request upon waking. Subsequent requests will perform normally.</p>

<p>To avoid this, you can scale to more than one web dyno. For example:</p>

<pre><code class="term">$ heroku ps:scale web=2
</code></pre>

<p>For each application, Heroku provides <a href="https://devcenter.heroku.com/articles/usage-and-billing#750-free-dyno-hours-per-app">750 free dyno-hours</a>.  Running your app at 2 dynos would exceed this free, monthly allowance, so let’s scale back:</p>

<pre><code class="term">$ heroku ps:scale web=1
</code></pre>

<h2 id="console">Console</h2>

<p>Heroku allows you to run commands in a <a href="https://devcenter.heroku.com/articles/one-off-dynos">one-off dyno</a> - scripts and applications that only need to be executed when needed - using the <code>heroku run</code> command. Use this to launch a Rails console process attached to your local terminal for experimenting in your app’s environment:</p>

<pre><code class="term">$ heroku run rails console
irb(main):001:0&gt; puts 1+1
2
</code></pre>

<h2 id="rake">Rake</h2>

<p>Rake can be run as an attached process exactly like the console:</p>

<pre><code class="term">$ heroku run rake db:migrate
</code></pre>

<h2 id="webserver">Webserver</h2>

<p>By default, your app’s web process runs <code>rails server</code>, which uses <a href="https://devcenter.heroku.com/articles/ruby-default-web-server">Webrick</a>. This is fine for testing, but for production apps you’ll want to switch to a more robust webserver. On Cedar, <a href="https://devcenter.heroku.com/articles/rails-unicorn">we recommend Unicorn as the webserver</a>. Regardless of the webserver you choose, production apps should always specify the webserver explicitly in the <code>Procfile</code>.</p>

<p>First, add Unicorn to your application <code>Gemfile</code>:</p>

<p>At the end of <code>Gemfile</code> add:</p>

<pre><code class="ruby">gem 'unicorn'
</code></pre>

<p>Then run</p>

<pre><code class="term">$ bundle install
</code></pre>

<p>Now you are ready to configure your app to use Unicorn.</p>

<p>Create a configuration file for Unicorn at <code>config/unicorn.rb</code>:</p>

<pre><code class="term">$ touch config/unicorn.rb
</code></pre>

<p>Now we’re going to add Unicorn specific configuration options, that we explain in detail in <a href="https://devcenter.heroku.com/articles/rails-unicorn">Heroku’s Unicorn documentation</a>:</p>

<p>In file <code>config/unicorn.rb</code> write:</p>

<pre><code class="ruby">
worker_processes Integer(ENV["WEB_CONCURRENCY"] || 3)
timeout 15
preload_app true

before_fork do |server, worker|
  Signal.trap 'TERM' do
    puts 'Unicorn master intercepting TERM and sending myself QUIT instead'
    Process.kill 'QUIT', Process.pid
  end

  defined?(ActiveRecord::Base) and
    ActiveRecord::Base.connection.disconnect!
end

after_fork do |server, worker|
  Signal.trap 'TERM' do
    puts 'Unicorn worker intercepting TERM and doing nothing. Wait for master to send QUIT'
  end

  defined?(ActiveRecord::Base) and
    ActiveRecord::Base.establish_connection
end
</code></pre>

<p>This default configuration assumes a standard Rails app with Active Record. You should get acquainted with the different options in <a href="http://unicorn.bogomips.org/Unicorn/Configurator.html">the official Unicorn documentation</a>.</p>

<p>Finally you will need to tell Heroku how to run your Rails app by creating a <code>Procfile</code> in the root of your application directory.</p>

<h3 id="procfile">Procfile</h3>

<p>Change the command used to launch your web process by creating a file called <a href="https://devcenter.heroku.com/articles/procfile">Procfile</a> and entering this:</p>

<p>In file <code>Procfile</code> write:</p>

<pre><code>web: bundle exec unicorn -p $PORT -c ./config/unicorn.rb
</code></pre>

<p>Note: The case of <code>Procfile</code> matters, the first letter must be uppercase.</p>

<p>Set the <code>RACK_ENV</code> to development in your environment and a <code>PORT</code> to connect to. Before pushing to Heroku you’ll want to test with the <code>RACK_ENV</code> set to production since this is the enviroment your Heroku app will run in.</p>

<pre><code class="term">$ echo "RACK_ENV=development" &gt;&gt; .env
$ echo "PORT=3000" &gt;&gt; .env
</code></pre>

<p>You’ll also want to add <code>.env</code> to your <code>.gitignore</code> since this is for local enviroment setup.</p>

<pre><code class="term">$ echo ".env" &gt;&gt; .gitignore
$ git add .gitignore
$ git commit -m "add .env to .gitignore"
</code></pre>

<p>Test your Procfile locally using Foreman:</p>

<pre><code class="term">$ gem install foreman
</code></pre>

<p>You can now start your web server by running</p>

<pre><code class="term">$ foreman start
18:24:56 web.1  | I, [2013-03-13T18:24:56.885046 #18793]  INFO -- : listening on addr=0.0.0.0:5000 fd=7
18:24:56 web.1  | I, [2013-03-13T18:24:56.885140 #18793]  INFO -- : worker=0 spawning...
18:24:56 web.1  | I, [2013-03-13T18:24:56.885680 #18793]  INFO -- : master process ready
18:24:56 web.1  | I, [2013-03-13T18:24:56.886145 #18795]  INFO -- : worker=0 spawned pid=18795
18:24:56 web.1  | I, [2013-03-13T18:24:56.886272 #18795]  INFO -- : Refreshing Gem list
18:24:57 web.1  | I, [2013-03-13T18:24:57.647574 #18795]  INFO -- : worker=0 ready
</code></pre>

<p>Looks good, so press Ctrl-C to exit and you can deploy your changes to Heroku:</p>

<pre><code class="term">$ git add .
$ git commit -m "use unicorn via procfile"
$ git push heroku master
</code></pre>

<p>Check <code>ps</code>, you’ll see the web process uses your new command specifying Unicorn as the web server</p>

<pre><code class="term">$ heroku ps
=== web (1X): `bundle exec unicorn -p $PORT -c ./config/unicorn.rb`
web.1: starting 2014/04/17 12:55:33 (~ 1s ago)
</code></pre>

<p>The logs also reflect that we are now using Unicorn:</p>

<pre><code class="term">$ heroku logs
</code></pre>

<h2 id="rails-asset-pipeline">Rails Asset Pipeline</h2>

<p>There are several options for invoking the <a href="http://guides.rubyonrails.org/asset_pipeline.html">Rails asset pipeline</a> when deploying to Heroku. For general information on the asset pipeline please see the <a href="https://devcenter.heroku.com/articles/rails-asset-pipeline">Rails 3.1+ Asset Pipeline on Heroku Cedar</a> article.</p>

<p>The <code>config.assets.initialize_on_precompile</code> option has been removed is and not needed for Rails 4. Also, any failure in asset compilation will now cause the push to fail. For Rails 4 asset pipeline support see the <a href="https://devcenter.heroku.com/articles/ruby-support#rails-4-x-applications">Ruby Support</a> page.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If you push up your app and it crashes (<code>heroku ps</code> shows state <code>crashed</code>), check your logs to find out what went wrong. Here are some common problems.</p>

<h3 id="runtime-dependencies-on-development-test-gems">Runtime dependencies on development/test gems</h3>

<p>If you’re missing a gem when you deploy, check your Bundler groups. Heroku builds your app without the <code>development</code> or <code>test</code> groups, and if you app depends on a gem from one of these groups to run, you should move it out of the group.</p>

<p>One common example using the RSpec tasks in your <code>Rakefile</code>. If you see this in your Heroku deploy:</p>

<pre><code class="term">$ heroku run rake -T
Running `bundle exec rake -T` attached to terminal... up, ps.3
rake aborted!
no such file to load -- rspec/core/rake_task
</code></pre>

<p>Then you’ve hit this problem. First, duplicate the problem locally:</p>

<pre><code class="term">$ bundle install --without development:test
…
$ bundle exec rake -T
rake aborted!
no such file to load -- rspec/core/rake_task
</code></pre>

<p>Now you can fix it by making these Rake tasks conditional on the gem load. For example:</p>

<h3 id="rakefile">Rakefile</h3>

<pre><code class="ruby">begin
  require "rspec/core/rake_task"
  desc "Run all examples"
  RSpec::Core::RakeTask.new(:spec) do |t|
    t.rspec_opts = %w[--color]
    t.pattern = 'spec/**/*_spec.rb'
  end
rescue LoadError
end
</code></pre>

<p>Confirm it works locally, then push to Heroku.</p>

<h2 id="done">Done</h2>

<p>You now have your first application deployed to Heroku. The next step is to deploy your own application. If you’re interested in reading more you can read more about <a href="https://devcenter.heroku.com/categories/ruby">Ruby on Heroku at the Dev Center</a>.</p>