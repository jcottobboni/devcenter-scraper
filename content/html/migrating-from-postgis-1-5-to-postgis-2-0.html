<p>PostGIS 2.0 is now available in public beta to Heroku Postgres customers on
production tier plans (Crane and up).  It brings improved stability and features to spatial applications.</p>

<h2 id="installation">Installation</h2>

<p>Unlike PostGIS 1.5, it is available as a Postgres extension on Postgres 9.2 databases. 
To install PostGIS in your database, run the following from a <code>psql</code> console:</p>

<pre><code>CREATE EXTENSION postgis;
</code></pre>

<h2 id="postgis-1-5-to-2-0-migration">PostGIS 1.5 to 2.0 Migration</h2>

<p>To migrate an old Heroku Postgres database running PostGIS 1.5 to the new
architecture, please follow these steps:</p>

<h3 id="create-a-target-database">Create a target database</h3>

<pre><code class="term">$ heroku addons:add heroku-postgresql:ronin --version=9.2 --app your-app
Adding heroku-postgresql:ronin on hgmnz... done, v29 ($200/mo)
Attached as HEROKU_POSTGRESQL_LAVANDA_URL
The database should be available in 3-5 minutes.
 ! The database will be empty. If upgrading, you can transfer
 ! data from another database with pgbackups:restore.
Use `heroku pg:wait` to track status..
Use `heroku addons:docs heroku-postgresql:ronin` to view documentation.
</code></pre>

<h3 id="create-the-postgis-extension-on-the-new-database">Create the postgis extension on the new database</h3>

<pre><code class="term">$ heroku pg:psql LAVANDA --app your-app
&gt; CREATE EXTENSION postgis;
</code></pre>

<h3 id="transfer-your-data-to-a-new-postgres-database">Transfer your data to a new Postgres database</h3>

<p>The fastest way to do this is to use the pgbackups:transfer command available
from the <a href="https://github.com/heroku/heroku-pg-extras">heroku pg-extras</a> plugin.</p>

<p>Install the plugin via</p>

<pre><code class="term">$ heroku plugins:install git://github.com/heroku/heroku-pg-extras.git
</code></pre>

<p>This command requires the pgbackups addon. If you don’t already have it installed
on your app, install it now:</p>

<pre><code class="term">$ heroku addons:add pgbackups --app your-app
Adding pgbackups on hgmnz... done, v32 (free)
You can now use "pgbackups" to backup your databases or import an external backup.
Use `heroku addons:docs pgbackups` to view documentation.
</code></pre>

<p>Place your application in maintenance mode, and scale down any workers:</p>

<pre><code class="term">$ heroku maintenance:on --app your-app
$ heroku ps:scale worker=0 another_worker=0 --app your-app
</code></pre>

<p>Finally, transfer data from your old database to your new one:</p>

<pre><code class="term">$ heroku pgbackups:transfer &lt;OLD_DATABASE_COLOR&gt; LAVANDA --app your-app
</code></pre>

<p>Depending on your data size, the transfer may take a while. You can track
progress of the transfer by tailing your application logs from another shell
window:</p>

<pre><code class="term">$ heroku logs --tail -p pbackups --app your-app
</code></pre>

<h3 id="verify-data-and-promote-your-new-database">Verify data and promote your new database</h3>

<p>You can now gain a connection to your new database and run queries verifying
that your data looks as expected. You can also point a staging application to
it to verify that your it works well with Postgis 2.0.</p>

<p>After you’re ready to use the Postgis 2.0 database as the primary for your
application, simply promote it:</p>

<pre><code class="term">$ heroku pg:promote HEROKU_POSTGRESQL_LAVANDA --app your-app
Promoting HEROKU_POSTGRESQL_LAVANDA_URL to DATABASE_URL... done
</code></pre>

<p>Now that the new database is up and running, scale it back up:</p>

<pre><code class="term">$ heroku maintenance:off --app your-app
$ heroku ps:scale worker=4 another_worker=2 --app your-app
</code></pre>

<h3 id="remove-old-database">Remove old database</h3>

<p>Once your new database has been migrated and promoted, you can safely remove
your old one:</p>

<pre><code class="term">$ heroku addons:remove HEROKU_POSTGRESQL_&lt;OLD_DATABASE_COLOR&gt; --app your-app
</code></pre>