<p>The Heroku Cedar stack is capable of running a variety of types of Scala applications.</p>

<p>This document describes the general behavior of the Cedar stack as it relates to the recognition and execution of Scala applications. For a more detailed explanation of how to deploy an application, see:</p>

<p><a href="https://devcenter.heroku.com/articles/getting-started-with-scala">Getting Started with Scala on Heroku</a></p>

<h2 id="activation">Activation</h2>

<p>Scala applications are recognized when files matching any of the following patterns are found:</p>

<ul>
<li><code>/*.sbt</code></li>
<li><code>/project/*.scala</code></li>
<li><code>/project/build.properties</code></li>
<li><code>/.sbt/*.scala</code></li>
</ul><p>When a deployed application is recognized as a Scala application, Heroku responds with <code>-----&gt; Scala app detected</code>.</p>

<pre><code class="term">$ git push heroku master
-----&gt; Scala app detected
</code></pre>

<p>If an application also contains a <code>/conf/application.conf</code> file, a Play 2.0 application is detected and Heroku responds with <code>-----&gt; Play 2.0 app detected</code>. Please see the <a href="https://devcenter.heroku.com/articles/play-support">Heroku Play Support</a> article for more information.</p>

<p>Scala applications that use Maven can be deployed as well, but they will be treated as Java applications, so <a href="https://devcenter.heroku.com/articles/java-support">Heroku Java Support</a> will apply.</p>

<h2 id="environment">Environment</h2>

<p>The following environment variables will be set:</p>

<ul>
<li>
<code>PATH</code>: <code>.sbt_home/bin:/usr/local/bin:/usr/bin:/bin</code>
</li>
<li>
<code>JAVA_OPTS</code>: <code>-Xmx384m -Xss512k -XX:+UseCompressedOops</code>
</li>
<li>
<code>SBT_OPTS</code>: <code>-Xmx384m -Xss512k -XX:+UseCompressedOops</code>
</li>
<li>
<code>REPO</code>: <code>/app/.sbt_home/.ivy2/cache</code>
</li>
<li>
<code>PORT</code>: HTTP port to which the web process should bind</li>
<li>
<code>DATABASE_URL</code>: URL of the <a href="https://devcenter.heroku.com/articles/heroku-postgresql">Heroku Postgres</a> database connection</li>
</ul><div class="note">
<p><a href="https://devcenter.heroku.com/articles/dyno-size">Resizing dynos</a> does not automatically change JVM memory settings. The <code>JAVA_OPTS</code> <a href="https://devcenter.heroku.com/articles/config-vars">config var</a> should be manually adjusted for the JVM.</p>
</div>

<h3 id="adjusting-environment-for-a-dyno-size">Adjusting Environment for a Dyno Size</h3>

<p>When a new dyno size is selected, the following <code>JAVA_OPTS</code> updates are recommended:</p>

<ul>
<li>
<code>1X</code>: -Xmx384m -Xss512k</li>
<li>
<code>2X</code>: -Xms768m -Xmx768m -Xmn192m</li>
<li>
<code>PX</code>: -Xmx4g -Xms4g -Xmn2g</li>
</ul><h3 id="monitoring-resource-usage">Monitoring Resource Usage</h3>

<p>Additional JVM flags can be used to monitor resource usage in a dyno. The following flags are recommended for monitoring resource usage:</p>

<pre><code>-XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+UseConcMarkSweepGC
</code></pre>

<p>See the <a href="https://devcenter.heroku.com/articles/java-memory-issues">troubleshooting</a> article for more information about tuning a JVM process.</p>

<h2 id="build-behavior">Build behavior</h2>

<p>Applications must include a <code>/project/build.properties</code> file with the <code>sbt.version</code> property specifying a release version of SBT 0.11.0 - 0.13.5. SBT release candidates (i.e. RC versions) are not supported.</p>

<p>The Heroku Scala buildpack will run <code>sbt compile stage</code> to build the application. Applications must include a <code>stage</code> task, which performs any tasks needed to prepare an application to be run in-place. For example, Typesafe’s <a href="https://github.com/sbt/sbt-start-script"><code>sbt-start-script</code></a> adds a <code>stage</code> task to SBT that generates start scripts for an application. To use the plugin, create a <code>/project/build.sbt</code> file containing:</p>

<pre><code>resolvers += Classpaths.typesafeResolver

addSbtPlugin("com.typesafe.sbt" %% "sbt-start-script" % "0.10.0")
</code></pre>

<h3 id="clean-builds">Clean builds</h3>

<p>In some cases, builds need to clean artifacts before compiling. If a clean build is necessary, configure builds to perform <code>clean</code> by setting <code>SBT_CLEAN=true</code>:</p>

<pre><code>$ heroku config:set SBT_CLEAN=true
Setting config vars and restarting example-app... done, v17
SBT_CLEAN: true
</code></pre>

<p>All subsequent deploys will use the <code>clean</code> task. To remove the <code>clean</code> task, unset <code>SBT_CLEAN</code>:</p>

<pre><code>$ heroku config:unset SBT_CLEAN
Unsetting SBT_CLEAN and restarting example-app... done, v18
</code></pre>

<h2 id="runtime-behavior">Runtime behavior</h2>

<p>By default, Scala applications are launched with start script generated by the <a href="https://github.com/sbt/sbt-start-script"><code>sbt-start-script</code></a>:</p>

<pre><code>web: target/start -Dhttp.port=$PORT $JAVA_OPTS
</code></pre>

<p>If an application is not using the <a href="https://github.com/sbt/sbt-start-script"><code>sbt-start-script</code></a> or should be launched in a different way, a custom <a href="https://devcenter.heroku.com/articles/procfile"><code>Procfile</code></a> can be included in the root of the project specifying a different entry for the <code>web</code> process.</p>

<h3 id="supported-java-versions">Supported Java versions</h3>

<p>Heroku currently uses OpenJDK to run your application. OpenJDK versions 6 and 7 are available.</p>

<p>You’re able to select Java 6 or 7. Depending on which you select the latest available version of that Java runtime will be used each time you deploy your app.</p>

<p>Current versions are:</p>

<ul>
<li>Java 6 - <code>1.6.0_27</code>
</li>
<li>Java 7 - <code>1.7.0_45</code>
</li>
</ul><p>The JDK that your app uses will be included in the slug, which will affect your slug size.</p>

<h3 id="specifying-a-java-version">Specifying a Java version</h3>

<p>You can specify a Java version by adding a file called <code>system.properties</code> to your application.</p>

<p>Set a property <code>java.runtime.version</code> in the file:</p>

<pre><code>java.runtime.version=1.7
</code></pre>

<p>1.6 is the default so if you’d like to use Java 6 you don’t need this file at all.</p>

<h2 id="add-ons">Add-ons</h2>

<p>A Heroku Postgres starter-tier database add-on is automatically provisioned for Scala applications. This populates the <code>DATABASE_URL</code> environment variable.</p>